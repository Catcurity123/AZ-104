#### A. EntraID Overview

###### What is EntraID
(+) **Entra ID** is the rebranded name of what was formerly known as `Azure Active Directory` (Azure AD).
(+) It is an `Identity Platform` - which is a mapping of what `entities` can do to `resources`. EntraID achieve this through `Entra ID Tenant`, mapping of Entities to Resources

![[Pasted image 20251224002305.png]]

###### Azure Subscription Relationship
(+) To set up Entra ID Tenant, we will need to set up a domain for Entra ID `ausemart.onmicrosoft.com` for example, or we can set up a custom domain `aus-e-mart.com`
(+) Once that is done we can set up our objects: registered applications, users, security groups, devices...
(+) For this to work, we need to associate our Entra ID Tenant with one or more `Azure Subscription` (maybe different subscription for different environments).

![[Pasted image 20251224002808.png]]
###### Entra ID Extended features
(+) `Privileged Identity Management`: JIT access, access review
(+) `Conditional Access`: Conditional Access Policies
(+) `Identity Protection`: Sign-in Risk or User Risk
==> However, these features may not be in the free tier.

![[Pasted image 20251224003035.png]]

#### B. Entra ID User Identities
(+) Enables people to access enterprise managed resources easily. An identity stores properties like Name, Office, Authz
(+) Can be created in the cloud with no on-premises infrastructure required
(+) Or it can be synchronized from on-premises or invited (as a guset) from partner identities.
(+) Support creds auth and MFA

![[Pasted image 20251225095852.png]]

#### C. Entra ID Application Identities
(+) Enable an application (on-prem or external application) to access a resource on Azure through `Application Identities`.
(+) Help control both access to an app, and the access an app has to other resources.
(+) The app itself can reside anywhere, inside or outside of Azure
(+) Application must registered within an Entra ID tenant (Application Registration)
(+) Authentication relies on the use of a client secret or certificate.

![[Pasted image 20251225101247.png]]

###### Application Identity Attributes in Application Registration
(+) `Authentication`: Configure redirect URI, or reply URL, is the location where the Entra authorization server sends the user and delivers tokens once the user has successfully signed in or signed out.
(+) `Certificates & secrets`: Requiring secrets or certificate when another application wants to have access.
(+) `API Permissions`: Authorized the application to use API of other application
(+) `App roles`: Assign permission to users or apps.

###### Application Identity Attributes in Application Enterprise
This is Enterprise setting for controlling/administrating application on an enterprise level, for example, configure service owner, groups, and whether the users in an organization can view the details of the application.

#### D. Managed Identities
(+) Provides an identity to a resource that exists within an Azure subscription. We can still use application identity for this case, but managed identity will ease the burden of credentials management.
(+) Authentication is managed by the Azure platform (no creds need to be stored)
(+) `System-assigned` enable a single resource for as long as it exists, if we delete the resource then the identity is also deleted.
(+) `User-assigned` you can create a managed identity to be used by one or more resources, if we delete the resource it will not be deleted
![[Pasted image 20251225113219.png]]

###### Demo: Grating access to principal in Azure
(+) In Azure, permission is the combination of `identity` and `access or role assignment`. Meaning if we want a principal to have access to something, we must create an identity (it can either be user's identity, app's identity or managed identity) and assign an access or role with that identity.

###### 1. Granting Access using app's identity
(+) Create the application's identity. If we want to access an identity (as VM for example, without logging in does not have any identity hence no access), we will need to create a `certificate or a secret`. So that we can use to log in.

![[Pasted image 20251225121612.png]]
(+) This will give us an identity and a credential to log in, then we need to grant the access permission at the resource that this identity need access.
![[Pasted image 20251225122614.png]]

(+) This will give the created `identity` the `access` to this resource group. Then we can log into the VM using this `Identity`.

(1) `az login --service-principal -p {secret_id_created_earlier} -u {application_id_from_appidentity} --tenant {directory_tenant_id}`: to log in using the identity.

![[Pasted image 20251225123256.png]]

(2) `az group list`: to list the resource group details

###### 2. Grating Access using system-assigned Identity
(+) After deploying a VM, we can toggle the managed identity in the `Identity` section of the VM.
![[Pasted image 20251225115838.png]]
(+) This will enable `System assigned identity` for the VM, meaning Azure will create an identity and manage it for us. The identity is for this VM only. 

(+) Similarly after that, we will grant access to the resource group to this managed identity.
![[Pasted image 20251225122614.png]]

(+) Then we can log into the managed identity on the VM using:
	(1) `az login --identity`: Login using identity
	(2) `az group list`: to list the resource group details

###### 3. Grating Access using user-assigned Identity
(+) After deploying a VM, we can add the VM to the created user identity
![[Pasted image 20251225124931.png]]

(+) This will enable `user assigned identity` for the VM, meaning Azure will create an identity and manage it for us. The identity is for this VM only. 

(+) Similarly after that, we will grant access to the resource group to this managed identity.
![[Pasted image 20251225122614.png]]

(+) Then we can log into the managed identity on the VM using:
	(1) `az login --identity`: Login using identity
	(2) `az group list`: to list the resource group details

#### E. Entra ID Groups
(+) Reduced Administration by simplify access to permissions, apps, and licensing
(+) Improved security by reducing the incorrect assignment of permissions
(+) Automation and self-service by leveraging automation and providing users with selfs-service

###### Security group
![[Pasted image 20251225125449.png]]

(+) Simplify assignment of Entra ID roles, Azure RBAC, and Entra ID Licensing.
(+) Allows an `Owner` to be specified, providing self-service capabilities
(+) Members can be assigned manually (assigned user group)
(+) Members can be assigned dynamically (assigned dynamic group)

###### Microsoft 365 Groups
![[Pasted image 20251225125741.png]]

(+) Similar to Security Groups but it is for Microsoft 365's resources not Azure resources.

###### Dynamic Groups
 (+) Configure rules to have group membership managed by the platform. This works by creating specific rules, if user's properties match the rule, they will be added to the group automatically.
![[Pasted image 20251225141431.png]]

(+) We can do the same for Microsoft 365's group. M365 group provides additional advanced features such as expiry, sensitive label
![[Pasted image 20251225141510.png]]

(+) We also have Dynamic Device Groups
![[Pasted image 20251225141554.png]]

###### NOTE
(+) Dynamic user and M365 Groups require Entra ID P1 license
(+) We cannot manually change the membership of dynamic groups
(+) Dynamic groups can be for devices or users (but not both at the same time)

#### F. Administrative Units
(+) The function is created to allow PoLP for Administrator using `Administrative Units`.
(+) Simplifies the assignment of Entra ID permission to Entra ID objects
(+) This is a mix of ENtra ID Users, Devices, and Security Groups.
(+) Membership can be assigned, or dynamic.
(+) Allow objects to exist in multiple AU at the same time.
![[Pasted image 20251225142455.png]]

(+) We can also create a `restricted administrative units` for managing access to VIP's identity. This setting will block access to restricted AU for tenant admin
![[Pasted image 20251225142738.png]]

###### NOTE
(+) Permissions do not apply to the members of security groups
(+) We cannot nest an AU within another AU

#### CASE STUDY
![[Pasted image 20251225143540.png]]

###### Current state
![[Pasted image 20251225143622.png]]

![[Pasted image 20251225143712.png]]

![[Pasted image 20251225143749.png]]

###### Requirement
![[Pasted image 20251225143914.png]]

###### Question
![[Pasted image 20251225144115.png]]

![[Pasted image 20251225144438.png]]

###### Solution
![[Pasted image 20251225144835.png]]
